<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Emoji Guess</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 640px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .emoji {
            font-size: 6rem;
            text-align: center;
            margin: 1rem 0;
        }

        fieldset {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 1rem;
        }

        .row {
            display: flex;
            gap: .75rem;
            align-items: center;
        }

        .badge {
            background: #f6f6ff;
            border: 1px solid #e4e4ff;
            padding: .25rem .6rem;
            border-radius: 8px;
        }

        button {
            padding: .6rem 1rem;
            border: 1px solid #ccc;
            border-radius: 10px;
            background: #fafafa;
            cursor: pointer;
        }

        button:hover {
            background: #f0f0f0;
        }

        .result {
            min-height: 1.25rem;
            margin-top: .75rem;
        }

        .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: .5rem;
        }
    </style>
</head>

<body>
    <h1>üéØ Emoji Guessing Game</h1>
    
    <div class="row" style="margin-top:0.5rem; gap:0.5rem">
        <input id="playerName" placeholder="Your name" style="flex:1; padding:.5rem" />
        <button type="button" id="submitScore">Submit</button>
    </div>
    
    <h2 style="margin-top:1.25rem">üèÜ Leaderboard</h2>
    <ol id="board"></ol>

    <div id="emoji" class="emoji">üôÇ</div>

    <form id="guess-form">
        <fieldset>
            <legend>What‚Äôs this emoji called?</legend>
            <div id="options"></div>
        </fieldset>

        <div class="row" style="margin-top:1rem">
            <button type="submit">Submit</button>
            <button type="button" id="next">Next</button>
            <button type="button" id="reset">Reset</button>
        </div>

        <div id="result" class="result"></div>
    </form>

    <script>
        let score = 0;
        let round = 0;
        let currentRound = null; // { emoji, options, correctAnswer }

        async function loadRound() {
            const res = await fetch("/api/round");
            currentRound = await res.json();
            round++;

            document.getElementById("emoji").textContent = currentRound.emoji;
            document.getElementById("round").textContent = `Round ${round}`;

            const optionsDiv = document.getElementById("options");
            optionsDiv.innerHTML = "";
            currentRound.options.forEach((name, i) => {
                const id = `opt-${i}`;
                const row = document.createElement("div");
                row.className = "row";
                row.innerHTML = `
            <input type="radio" id="${id}" name="choice" value="${name}">
            <label for="${id}">${name}</label>
          `;
                optionsDiv.appendChild(row);
            });

            document.getElementById("result").textContent = "";
        }

        document.getElementById("guess-form").addEventListener("submit", (e) => {
            e.preventDefault();
            if (!currentRound) return;

            const data = new FormData(e.currentTarget);
            const choice = data.get("choice");
            const result = document.getElementById("result");

            if (!choice) {
                result.textContent = "Please pick an option.";
                return;
            }

            const correct = choice === currentRound.correctAnswer;
            if (correct) {
                score++;
                document.getElementById("score").textContent = `Score ${score}`;
            }
            result.textContent = correct
                ? "‚úÖ Correct!"
                : `‚ùå Nope ‚Äî it was ‚Äú${currentRound.correctAnswer}‚Äù.`;
        });

        document.getElementById("next").addEventListener("click", loadRound);

        document.getElementById("reset").addEventListener("click", () => {
            score = 0;
            round = 0;
            currentRound = null;
            document.getElementById("score").textContent = "Score 0";
            document.getElementById("round").textContent = "Round 0";
            document.getElementById("result").textContent = "Game reset. Click Next.";
        });

        // boot
        loadRound();
    </script>
</body>

</html>